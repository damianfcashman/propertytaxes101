<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Help Me Understand My Property Tax Closing Costs</title>
<style>
  /* ---- Claude's modern design ---- */
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: #6a5acd;
    display: flex;
    justify-content: center;
    padding: 30px;
  }
  .container {
    background: white;
    border-radius: 15px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    padding: 30px;
    width: 900px;
  }
  h1 {
    text-align: center;
    font-size: 26px;
    color: #3f3d56;
    margin-bottom: 20px;
  }
  .input-grid {
    display: flex;
    justify-content: space-between;
    gap: 20px;
    margin-bottom: 25px;
  }
  .input-group {
    flex: 1;
    background: #fff;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 10px;
  }
  label {
    display: block;
    margin-bottom: 5px;
    font-weight: bold;
  }
  input {
    width: 100%;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 5px;
  }
  .timeline {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 10px;
    margin: 20px 0;
  }
  .month-box {
    background: #fff;
    padding: 10px;
    border: 1px solid #ccc;
    border-radius: 8px;
    width: 70px;
    text-align: center;
    font-size: 14px;
    position: relative;
  }
  .closing {
    background: #dbe9ff;
    border: 2px solid #4a90e2;
  }
  .first-payment {
    background: #e0ffe0;
    border: 2px solid #2ecc71;
  }
  .tax-due {
    background: #ffe5e5;
    border: 2px solid #e74c3c;
  }
  .shaded {
    background: #fdf6e3;
  }
  .arrow {
    margin: 20px 5px;
    font-weight: bold;
  }
  .info-box {
    background: #eef3ff;
    border-left: 5px solid #4a90e2;
    padding: 10px;
    border-radius: 5px;
    margin-bottom: 10px;
    font-size: 14px;
  }
  .results-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
    margin-top: 20px;
  }
  .result {
    background: #fff;
    padding: 10px;
    border: 1px solid #ddd;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    font-weight: bold;
  }
  .highlight {
    background: #fffbe6;
    border-left: 4px solid #f39c12;
  }
  .summary-box {
    background: #2c3e50;
    color: white;
    padding: 15px;
    text-align: center;
    margin-top: 20px;
    border-radius: 8px;
  }
  .summary-amount {
    font-size: 24px;
    font-weight: bold;
    color: #f1c40f;
  }
  .tooltip {
    display: none;
    background: black;
    color: white;
    position: absolute;
    padding: 5px;
    border-radius: 4px;
    bottom: -25px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 12px;
  }
  .month-box:hover .tooltip { display: block; }
</style>
</head>
<body>
<div class="container">
  <h1>Help Me Understand <br> My Property Tax Closing Costs</h1>
  
  <div class="input-grid">
    <div class="input-group">
      <label>Property Address</label>
      <input type="text" id="address" placeholder="123 Main Street, Hartford, CT" />
    </div>
    <div class="input-group">
      <label>Closing Date</label>
      <input type="date" id="closingDate" />
    </div>
    <div class="input-group">
      <label>Annual Property Taxes ($)</label>
      <input type="number" id="annualTax" placeholder="8500" />
    </div>
  </div>

  <div id="timeline" class="timeline"></div>

  <div class="info-box">
    <strong>üè† Property Taxes to the Seller:</strong> You reimburse the seller for property taxes they prepaid for the period you'll own the home.
  </div>
  <div class="info-box">
    <strong>üè¶ Property Taxes to Escrow:</strong> Taxes are due every 6 months (January and July). Your lender collects funds in advance in an escrow account to pay these bills on time.
  </div>
  <div class="info-box" id="lenderCalcInfo">
    <strong>üßÆ How Lenders Calculate:</strong> Enter your info to see calculation.
  </div>

  <div class="results-grid">
    <div class="result"><span>Monthly Tax Amount</span><span id="monthlyTax">$0</span></div>
    <div class="result highlight"><span>Property Tax Owed to Seller</span><span id="sellerCredit">$0</span></div>
    <div class="result"><span>Tax Bill Paid at Closing</span><span id="taxBillPaid">$0</span></div>
    <div class="result"><span>Months Collected in Escrow</span><span id="escrowMonths">0</span></div>
    <div class="result highlight"><span>Total Escrow Collected</span><span id="totalEscrow">$0</span></div>
    <div class="result"><span>First Mortgage Payment</span><span id="firstPayment">N/A</span></div>
  </div>

  <div class="summary-box">
    <h3>Total Property Tax Costs at Closing</h3>
    <div class="summary-amount" id="totalClosingTax">$0</div>
  </div>
</div>

<script>
const allMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const monthlyTaxSpan = document.getElementById('monthlyTax');
const sellerCreditSpan = document.getElementById('sellerCredit');
const taxBillPaidSpan = document.getElementById('taxBillPaid');
const escrowMonthsSpan = document.getElementById('escrowMonths');
const totalEscrowSpan = document.getElementById('totalEscrow');
const firstPaymentSpan = document.getElementById('firstPayment');
const totalClosingTaxSpan = document.getElementById('totalClosingTax');
const lenderCalcInfo = document.getElementById('lenderCalcInfo');
const timelineDiv = document.getElementById('timeline');

function formatCurrency(amount) {
  return new Intl.NumberFormat('en-US', {style:'currency',currency:'USD',minimumFractionDigits:0}).format(amount);
}

function calculateAndRender() {
  const annualTax = parseFloat(document.getElementById('annualTax').value) || 0;
  const closingDateInput = document.getElementById('closingDate').value;
  if (!annualTax || !closingDateInput) return;

  const monthlyTax = annualTax / 12;
  monthlyTaxSpan.textContent = formatCurrency(monthlyTax);

  const closingDate = new Date(closingDateInput);
  const closingMonth = closingDate.getMonth();
  const closingYear = closingDate.getFullYear();
  const halfYearTax = annualTax / 2;

  const currentPeriodStart = (closingMonth >= 6) ? new Date(closingYear, 6, 1) : new Date(closingYear, 0, 1);
  const currentPeriodEnd = (closingMonth >= 6) ? new Date(closingYear + 1, 0, 1) : new Date(closingYear, 6, 1);
  const msPerDay = 1000 * 60 * 60 * 24;
  const totalDays = Math.ceil((currentPeriodEnd - currentPeriodStart) / msPerDay);
  const daysRemaining = Math.ceil((currentPeriodEnd - closingDate) / msPerDay);
  const sellerCredit = (halfYearTax / totalDays) * daysRemaining;
  sellerCreditSpan.textContent = formatCurrency(sellerCredit);

  const nextBillDate = (closingMonth >= 6) ? new Date(closingYear + 1, 0, 1) : new Date(closingYear, 6, 1);
  const nextBillMonth = nextBillDate.getMonth();
  const daysToNextBill = Math.ceil((nextBillDate - closingDate) / msPerDay);

  let taxBillPaid = 0, escrowMonths = 0;
  if (daysToNextBill <= 60) {
    taxBillPaid = halfYearTax;
    escrowMonths = 2; 
  } else {
    const monthsShort = (closingMonth >= 6) ? (12 - (closingMonth + 1)) : (6 - (closingMonth + 1));
    escrowMonths = monthsShort + 1;
  }

  taxBillPaidSpan.textContent = formatCurrency(taxBillPaid);
  escrowMonthsSpan.textContent = escrowMonths;
  const totalEscrowAmount = monthlyTax * escrowMonths;
  totalEscrowSpan.textContent = formatCurrency(totalEscrowAmount);

  const totalClosingCosts = sellerCredit + taxBillPaid + totalEscrowAmount;
  totalClosingTaxSpan.textContent = formatCurrency(totalClosingCosts);

  const firstPaymentMonth = (closingMonth + 2) % 12;
  const firstPaymentYear = closingYear + Math.floor((closingMonth + 2) / 12);
  firstPaymentSpan.textContent = `${allMonths[firstPaymentMonth]} ${firstPaymentYear}`;

  lenderCalcInfo.innerHTML = `<strong>üßÆ How Lenders Calculate:</strong> You'll reimburse the seller ${formatCurrency(sellerCredit)}. 
    ${taxBillPaid>0?`Tax bill ${formatCurrency(taxBillPaid)} is paid at closing.`:''} 
    Lender collects ${escrowMonths} months (${formatCurrency(totalEscrowAmount)}). 
    First mortgage payment ${allMonths[firstPaymentMonth]} ${firstPaymentYear}.`;

  renderTimeline(closingMonth, firstPaymentMonth, nextBillMonth);
}

function renderTimeline(closingMonth, firstPaymentMonth, nextBillMonth) {
  timelineDiv.innerHTML = '';
  const monthsToShow = [];
  let current = closingMonth;
  while (true) {
    monthsToShow.push(current);
    if (current === nextBillMonth) break;
    current = (current + 1) % 12;
  }
  for (let i = 1; i <= 6; i++) {
    monthsToShow.push((nextBillMonth + i) % 12);
  }

  monthsToShow.forEach((monthIdx, index) => {
    const box = document.createElement('div');
    box.classList.add('month-box');
    if (monthIdx >= 6) box.classList.add('shaded');

    let label = '';
    if (monthIdx === closingMonth) {
      box.classList.add('closing');
      label = "üè†<br><span class='month-label'>Closing</span>";
    } else if (index < monthsToShow.indexOf(nextBillMonth)) {
      label = "üí∞";
    }
    if (monthIdx === 0 || monthIdx === 6) {
      box.classList.add('tax-due');
      label = "üßæ<br><span class='month-label'>Next Tax Period</span>";
    }
    if (monthIdx === firstPaymentMonth) {
      box.classList.add('first-payment');
      if (!label.includes('üè†') && !label.includes('üßæ')) {
        label = "üí≥<br><span class='month-label'>First Payment</span>";
      }
    }
    box.innerHTML = `${allMonths[monthIdx]}<br>${label}`;
    timelineDiv.appendChild(box);

    if (index < monthsToShow.length - 1) {
      const arrow = document.createElement('div');
      arrow.classList.add('arrow');
      arrow.textContent = "‚Üí";
      timelineDiv.appendChild(arrow);
    }
  });
}

document.getElementById('annualTax').addEventListener('input', calculateAndRender);
document.getElementById('closingDate').addEventListener('change', calculateAndRender);
</script>
</body>
</html>
