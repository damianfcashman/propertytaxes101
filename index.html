<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Help Me Understand My Property Tax Closing Costs</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, sans-serif;
    background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
    min-height: 100vh;
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 20px;
    margin: 0;
  }
  
  .container {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    padding: 40px;
    width: 100%;
    max-width: 950px;
    animation: fadeIn 0.6s ease-out;
  }
  
  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }
  
  h1 {
    text-align: center;
    font-size: 32px;
    color: #2c3e50;
    margin-bottom: 20px;
    font-weight: 900;
    line-height: 1.2;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica Neue', Arial, sans-serif;
    letter-spacing: -0.5px;
  }
  
  .profile-section {
    text-align: center;
    margin-bottom: 30px;
  }
  
  .profile-image {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    margin-bottom: 10px;
    border: 3px solid #4a5568;
    background: linear-gradient(135deg, #4a5568 0%, #2d3748 100%);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 700;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
    margin-left: auto;
    margin-right: auto;
    background-image: url('https://i.postimg.cc/MpZ2cfVm/New-Head-Shot-Casual.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
  }
  
  .profile-name {
    font-size: 16px;
    font-weight: 600;
    color: #495057;
    margin: 0;
  }
  
  .input-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
  }
  
  .input-group {
    background: #f8f9fa;
    padding: 20px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  }
  
  .input-group:hover {
    border-color: #4a5568;
    transform: translateY(-2px);
    box-shadow: 0 8px 20px rgba(74, 85, 104, 0.2);
  }
  
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: 600;
    color: #495057;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  
  input {
    width: 100%;
    padding: 12px;
    border: 2px solid #dee2e6;
    border-radius: 8px;
    font-size: 16px;
    transition: border-color 0.3s ease;
    box-sizing: border-box;
  }
  
  input:focus {
    outline: none;
    border-color: #4a5568;
    box-shadow: 0 0 0 3px rgba(74, 85, 104, 0.1);
  }
  
  .timeline {
    display: flex;
    justify-content: center;
    flex-wrap: wrap;
    gap: 8px;
    margin: 30px 0;
    padding: 40px 20px 20px 20px;
    background: #f8f9fa;
    border-radius: 15px;
    position: relative;
  }
  
  .month-box {
    background: white;
    border: 1px solid #c7c7cc;
    border-radius: 8px;
    width: 80px;
    text-align: center;
    font-weight: 600;
    position: relative;
    transition: all 0.3s ease;
    margin-top: 10px;
    box-shadow: 0 6px 18px rgba(0, 0, 0, 0.2);
    overflow: hidden;
  }
  
  .month-box::before {
    content: '';
    position: absolute;
    top: -2px;
    left: 12px;
    width: 2px;
    height: 6px;
    background: #333;
    border-radius: 1px;
    z-index: 3;
  }
  
  .month-box::after {
    content: '';
    position: absolute;
    top: -2px;
    right: 12px;
    width: 2px;
    height: 6px;
    background: #333;
    border-radius: 1px;
    z-index: 3;
  }
  
  .month-header {
    background: linear-gradient(180deg, #ff3b30 0%, #d70015 100%);
    color: white;
    padding: 4px 2px;
    font-size: 9px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    position: relative;
    z-index: 2;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  }
  
  .month-body {
    background: white;
    padding: 8px 4px 6px 4px;
    min-height: 40px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  }
  
  .month-detail {
    font-size: 9px;
    color: #000;
    font-weight: 800;
    line-height: 1.1;
    text-align: center;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
  }
  
  .detail-separator {
    width: 60%;
    height: 1px;
    background: #333;
    margin: 3px auto;
    opacity: 0.6;
  }
  
  .month-box:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 25px rgba(0, 0, 0, 0.25);
  }
  
  .closing .month-header {
    background: linear-gradient(180deg, #007aff 0%, #0051d5 100%);
  }
  
  .first-payment .month-header {
    background: linear-gradient(180deg, #34c759 0%, #248a3d 100%);
  }
  
  .tax-due .month-header {
    background: linear-gradient(180deg, #ff3b30 0%, #d70015 100%);
  }
  
  .shaded .month-header {
    background: linear-gradient(180deg, #ff9500 0%, #cc7700 100%);
  }
  
  .arrow {
    margin: 20px 5px;
    font-weight: bold;
    font-size: 18px;
    color: #4a5568;
  }
  
  .seller-period-container {
    position: absolute;
    top: 10px;
    left: 0;
    right: 0;
    height: 30px;
    z-index: 10;
  }
  
  .seller-period-bar {
    position: absolute;
    top: 8px;
    height: 6px;
    background: linear-gradient(90deg, #e74c3c, #c0392b);
    border-radius: 3px;
    box-shadow: 0 2px 8px rgba(231, 76, 60, 0.3);
    position: relative;
  }
  
  .seller-period-bar::before {
    content: '';
    position: absolute;
    left: -8px;
    top: -3px;
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-right: 8px solid #e74c3c;
    filter: drop-shadow(0 2px 4px rgba(231, 76, 60, 0.3));
  }
  
  .seller-period-bar::after {
    content: '';
    position: absolute;
    right: -8px;
    top: -3px;
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 8px solid #e74c3c;
    filter: drop-shadow(0 2px 4px rgba(231, 76, 60, 0.3));
  }
  
  .seller-period-label {
    position: absolute;
    top: -12px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #e74c3c, #c0392b);
    color: white;
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 11px;
    font-weight: 700;
    white-space: nowrap;
    box-shadow: 0 3px 10px rgba(231, 76, 60, 0.4);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .seller-period-label::after {
    content: '';
    position: absolute;
    bottom: -4px;
    left: 50%;
    transform: translateX(-50%);
    width: 0;
    height: 0;
    border-left: 4px solid transparent;
    border-right: 4px solid transparent;
    border-top: 4px solid #c0392b;
  }
  
  .info-box {
    background: linear-gradient(135deg, #e8f4f8, #d6eaf8);
    border-left: 5px solid #3498db;
    padding: 15px;
    border-radius: 10px;
    margin-bottom: 15px;
    font-size: 14px;
    line-height: 1.5;
  }
  
  .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 30px;
  }
  
  .result {
    background: white;
    padding: 20px;
    border: 2px solid #e9ecef;
    border-radius: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-weight: 600;
    transition: all 0.3s ease;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }
  
  .result:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
  }
  
  .highlight {
    background: linear-gradient(135deg, #fff9e6, #fef7dc);
    border-left: 4px solid #f39c12;
    border-color: #f39c12;
  }
  
  .result span:first-child {
    color: #495057;
    font-size: 14px;
  }
  
  .result span:last-child {
    color: #2c3e50;
    font-size: 16px;
    font-weight: 700;
  }
  
  .summary-box {
    background: linear-gradient(135deg, #2c3e50, #34495e);
    color: white;
    padding: 30px;
    text-align: center;
    margin-top: 30px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(44, 62, 80, 0.3);
  }
  
  .summary-box h3 {
    margin: 0 0 15px 0;
    font-size: 20px;
    font-weight: 600;
  }
  
  .summary-amount {
    font-size: 32px;
    font-weight: 700;
    color: #f1c40f;
    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
  }
  
  @media (max-width: 768px) {
    .container {
      padding: 20px;
      margin: 10px;
    }
    
    h1 {
      font-size: 24px;
    }
    
    .input-grid {
      grid-template-columns: 1fr;
    }
    
    .timeline {
      gap: 5px;
    }
    
    .month-box {
      width: 60px;
      padding: 10px 5px;
      font-size: 11px;
    }
    
    .arrow {
      margin: 15px 2px;
      font-size: 16px;
    }
    
    .results-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
</head>
<body>
<div class="container">
  <h1>Help Me Understand <br> My Property Tax Closing Costs</h1>
  
  <div class="profile-section">
    <div class="profile-image">DC</div>
    <p class="profile-name">Damian F. Cashman</p>
  </div>
  
  <div class="input-grid">
    <div class="input-group">
      <label>Property Address</label>
      <input type="text" id="address" placeholder="123 Main Street, Hartford, CT" />
    </div>
    <div class="input-group">
      <label>Closing Date</label>
      <input type="date" id="closingDate" />
    </div>
    <div class="input-group">
      <label>Annual Property Taxes ($)</label>
      <input type="number" id="annualTax" placeholder="6000" />
    </div>
  </div>

  <div id="timeline" class="timeline"></div>

  <div class="info-box" id="lenderCalcInfo">
    <strong>ðŸ§® How Lenders Calculate:</strong> Enter your closing date and annual property taxes above to see the detailed calculation breakdown.
  </div>

  <div class="results-grid">
    <div class="result"><span>Monthly Tax Amount</span><span id="monthlyTax">$0</span></div>
    <div class="result highlight"><span>Property Tax Owed to Seller</span><span id="sellerCredit">$0</span></div>
    <div class="result"><span>Upcoming Tax Bill</span><span id="taxBillPaid">$0</span></div>
    <div class="result"><span>Months Collected in Escrow</span><span id="escrowMonths">0</span></div>
    <div class="result highlight"><span>Total Escrow Collected</span><span id="totalEscrow">$0</span></div>
    <div class="result"><span>First Mortgage Payment</span><span id="firstPayment">N/A</span></div>
  </div>

  <div class="summary-box">
    <h3>Total Property Tax Costs at Closing</h3>
    <div class="summary-amount" id="totalClosingTax">$0</div>
  </div>
</div>

<script>
const allMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
const monthlyTaxSpan = document.getElementById('monthlyTax');
const sellerCreditSpan = document.getElementById('sellerCredit');
const taxBillPaidSpan = document.getElementById('taxBillPaid');
const escrowMonthsSpan = document.getElementById('escrowMonths');
const totalEscrowSpan = document.getElementById('totalEscrow');
const firstPaymentSpan = document.getElementById('firstPayment');
const totalClosingTaxSpan = document.getElementById('totalClosingTax');
const lenderCalcInfo = document.getElementById('lenderCalcInfo');
const timelineDiv = document.getElementById('timeline');

function formatCurrency(amount) {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  }).format(amount);
}

function calculateAndRender() {
  const annualTax = parseFloat(document.getElementById('annualTax').value) || 0;
  const closingDateInput = document.getElementById('closingDate').value;
  
  if (!annualTax || !closingDateInput) {
    resetDisplay();
    return;
  }

  const monthlyTax = annualTax / 12;
  monthlyTaxSpan.textContent = formatCurrency(monthlyTax);

  // Parse date carefully to avoid timezone issues
  const dateParts = closingDateInput.split('-');
  const closingDate = new Date(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2]));
  const closingMonth = closingDate.getMonth();
  const closingYear = closingDate.getFullYear();

  // Calculate seller credit using daily proration method
  const currentPeriodEnd = (closingMonth >= 6) ? new Date(closingYear + 1, 0, 1) : new Date(closingYear, 6, 1);
  const msPerDay = 1000 * 60 * 60 * 24;
  const daysRemaining = Math.ceil((currentPeriodEnd - closingDate) / msPerDay);
  const dailyRate = annualTax / 365;
  const sellerCredit = dailyRate * daysRemaining;
  sellerCreditSpan.textContent = formatCurrency(sellerCredit);

  // Determine next tax bill date
  const nextBillDate = (closingMonth >= 6) ? new Date(closingYear + 1, 0, 1) : new Date(closingYear, 6, 1);
  const nextBillMonth = nextBillDate.getMonth();
  const daysToNextBill = Math.ceil((nextBillDate - closingDate) / msPerDay);

  // Calculate first payment date (2 months after closing)
  const firstPaymentMonth = (closingMonth + 2) % 12;
  const firstPaymentYear = closingYear + Math.floor((closingMonth + 2) / 12);
  firstPaymentSpan.textContent = `${allMonths[firstPaymentMonth]} ${firstPaymentYear}`;

  // ESCROW CALCULATION - Completely rewritten
  const halfYearTax = annualTax / 2;
  let taxBillPaid = 0;
  let escrowMonths = 0;

  // Check if upcoming tax bill is paid at closing (within 30 days, not 60)
  if (daysToNextBill <= 30) {
    // Tax bill IS paid at closing
    taxBillPaid = halfYearTax;
    
    // Calculate for the tax bill AFTER the one being paid
    // If paying Jan bill, next bill is July. If paying July bill, next bill is Jan.
    const subsequentTaxBillMonth = (nextBillMonth === 0) ? 6 : 0;
    
    // Count mortgage payments from first payment to subsequent tax bill
    let paymentsToSubsequentBill = 0;
    let countMonth = firstPaymentMonth;
    while (countMonth !== subsequentTaxBillMonth) {
      paymentsToSubsequentBill++;
      countMonth = (countMonth + 1) % 12;
      if (paymentsToSubsequentBill > 12) break; // Safety
    }
    
    // Escrow = 6 months - payments that will be made + 1 buffer
    escrowMonths = (6 - paymentsToSubsequentBill) + 1;
    
  } else {
    // Tax bill is NOT paid at closing
    taxBillPaid = 0;
    
    // Count mortgage payments from first payment to next tax bill
    let paymentsToNextBill = 0;
    let countMonth = firstPaymentMonth;
    while (countMonth !== nextBillMonth) {
      paymentsToNextBill++;
      countMonth = (countMonth + 1) % 12;
      if (paymentsToNextBill > 12) break; // Safety
    }
    
    // Escrow = 6 months - payments that will be made + 1 buffer
    escrowMonths = (6 - paymentsToNextBill) + 1;
  }

  // Ensure minimum of 1 month escrow
  escrowMonths = Math.max(1, escrowMonths);

  taxBillPaidSpan.textContent = formatCurrency(taxBillPaid);
  escrowMonthsSpan.textContent = escrowMonths;
  const totalEscrowAmount = monthlyTax * escrowMonths;
  totalEscrowSpan.textContent = formatCurrency(totalEscrowAmount);

  const totalClosingCosts = sellerCredit + taxBillPaid + totalEscrowAmount;
  totalClosingTaxSpan.textContent = formatCurrency(totalClosingCosts);

  updateLenderExplanation(sellerCredit, taxBillPaid, escrowMonths, totalEscrowAmount, firstPaymentMonth, firstPaymentYear);
  renderTimeline(closingMonth, firstPaymentMonth, nextBillMonth);
}

function updateLenderExplanation(sellerCredit, taxBillPaid, escrowMonths, totalEscrowAmount, firstPaymentMonth, firstPaymentYear) {
  let explanation = `<strong>ðŸ“± How Lenders Calculate:</strong><br><br>`;
  
  explanation += `<strong>1. Property Tax Owed to Seller: <span style="color: #e74c3c;">${formatCurrency(sellerCredit)}</span></strong><br>`;
  explanation += `The seller already paid taxes for the current 6-month tax period, so you reimburse them for your portion.<br><br>`;
  
  if (taxBillPaid > 0) {
    explanation += `<strong>2. Your attorney collects <span style="color: #e74c3c;">${formatCurrency(taxBillPaid)}</span> for the upcoming tax bill</strong><br>`;
    explanation += `Since taxes are due within 30 days of closing, this gets paid at closing.<br><br>`;
  }
  
  explanation += `<strong>${taxBillPaid > 0 ? '3' : '2'}. Your first mortgage payment starts <span style="color: #4a5568;">${allMonths[firstPaymentMonth]} ${firstPaymentYear}</span></strong><br>`;
  explanation += `This gives you time to get settled before payments begin, but this also means that you don't start paying into your escrow until this time.<br><br>`;
  
  explanation += `<strong>${taxBillPaid > 0 ? '4' : '3'}. Total Escrow Collected: <span style="color: #f39c12;">${formatCurrency(totalEscrowAmount)}</span> (${escrowMonths} months)</strong><br>`;
  explanation += `Your lender collects this calculated amount for escrow. This money sits in a special account. Your lender uses it to pay property taxes twice a year. `;
  explanation += `They collect extra months now because if they waited until your first payment, there wouldn't be enough time to save up for the next tax bill. `;
  explanation += `They also add one extra month as a safety cushion in case your taxes go up.`;
  
  lenderCalcInfo.innerHTML = explanation;
}

function renderTimeline(closingMonth, firstPaymentMonth, nextBillMonth) {
  timelineDiv.innerHTML = '';
  
  const annualTax = parseFloat(document.getElementById('annualTax').value) || 0;
  const closingDateInput = document.getElementById('closingDate').value;
  
  const dateParts = closingDateInput.split('-');
  const closingDate = new Date(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2]));
  
  const monthsToShow = [];
  
  // First, add months from closing to the next tax bill (end of current period)
  let current = closingMonth;
  while (true) {
    monthsToShow.push(current);
    if (current === nextBillMonth) break;
    current = (current + 1) % 12;
  }
  
  // Then add exactly 6 months of the NEXT tax period
  // The next tax period starts the month after nextBillMonth
  const nextPeriodStart = (nextBillMonth + 1) % 12;
  
  // Add exactly 6 months from the start of next period
  for (let i = 0; i < 6; i++) {
    const monthToAdd = (nextPeriodStart + i) % 12;
    monthsToShow.push(monthToAdd);
  }

  monthsToShow.forEach((monthIdx, index) => {
    const box = document.createElement('div');
    box.classList.add('month-box');
    
    // Determine if this month is in the second half of the year (July-Dec)
    if (monthIdx >= 6) {
      box.classList.add('shaded');
    }

    let details = '';
    
    // Only show "Closing" for the very first occurrence of the closing month
    if (monthIdx === closingMonth && index === 0) {
      box.classList.add('closing');
      const closingDay = closingDate.getDate();
      details = `<div class="month-detail">Closing<br><span style="font-size: 18px; font-weight: 900; color: #000;">${closingDay}</span></div>`;
    }
    else if (monthIdx === 0 || monthIdx === 6) {
      box.classList.add('tax-due');
      if (monthIdx === firstPaymentMonth) {
        details = `<div class="month-detail">Tax Due<div class="detail-separator"></div>1st Mortgage Payment<br><span style="font-size: 18px; font-weight: 900; color: #000;">1</span></div>`;
      } else {
        details = `<div class="month-detail">Tax Due<br><span style="font-size: 18px; font-weight: 900; color: #000;">1</span></div>`;
      }
    }
    else if (monthIdx === firstPaymentMonth) {
      box.classList.add('first-payment');
      details = `<div class="month-detail">1st Mortgage<br>Payment</div>`;
    }
    
    box.innerHTML = `
      <div class="month-header">${allMonths[monthIdx]}</div>
      <div class="month-body">${details}</div>
    `;
    
    timelineDiv.appendChild(box);

    if (index < monthsToShow.length - 1) {
      const arrow = document.createElement('div');
      arrow.classList.add('arrow');
      arrow.textContent = "â†’";
      timelineDiv.appendChild(arrow);
    }
  });
  
  addSellerPeriodBar(closingMonth, nextBillMonth, monthsToShow);
}

function addSellerPeriodBar(closingMonth, nextBillMonth, monthsToShow) {
  const closingIndex = monthsToShow.indexOf(closingMonth);
  const nextBillIndex = monthsToShow.indexOf(nextBillMonth);
  
  if (closingIndex === -1 || nextBillIndex === -1 || closingIndex >= nextBillIndex) return;
  
  const annualTax = parseFloat(document.getElementById('annualTax').value) || 0;
  const closingDateInput = document.getElementById('closingDate').value;
  
  const dateParts = closingDateInput.split('-');
  const closingDate = new Date(parseInt(dateParts[0]), parseInt(dateParts[1]) - 1, parseInt(dateParts[2]));
  
  let totalReimbursement = 0;
  if (annualTax > 0) {
    const closingYear = closingDate.getFullYear();
    const closingMonthCalc = closingDate.getMonth();
    
    const currentPeriodEnd = (closingMonthCalc >= 6) ? new Date(closingYear + 1, 0, 1) : new Date(closingYear, 6, 1);
    
    const msPerDay = 1000 * 60 * 60 * 24;
    const daysRemaining = Math.ceil((currentPeriodEnd - closingDate) / msPerDay);
    
    const dailyRate = annualTax / 365;
    totalReimbursement = dailyRate * daysRemaining;
  }
  
  const monthBoxes = timelineDiv.querySelectorAll('.month-box');
  
  if (monthBoxes.length === 0) return;
  
  const closingBox = monthBoxes[closingIndex];
  const endBox = monthBoxes[nextBillIndex - 1];
  
  const container = document.createElement('div');
  container.classList.add('seller-period-container');
  
  const bar = document.createElement('div');
  bar.classList.add('seller-period-bar');
  
  const label = document.createElement('div');
  label.classList.add('seller-period-label');
  label.textContent = `Buyer Reimburses Seller = ${formatCurrency(totalReimbursement)}`;
  
  setTimeout(() => {
    const closingBoxRect = closingBox.getBoundingClientRect();
    const endBoxRect = endBox.getBoundingClientRect();
    const timelineRect = timelineDiv.getBoundingClientRect();
    
    const closingDay = closingDate.getDate();
    const daysInClosingMonth = new Date(closingDate.getFullYear(), closingDate.getMonth() + 1, 0).getDate();
    const positionInClosingMonth = (closingDay - 1) / daysInClosingMonth;
    
    const closingBoxWidth = closingBoxRect.width;
    const startOffset = closingBoxWidth * positionInClosingMonth;
    const startX = closingBoxRect.left - timelineRect.left + startOffset;
    
    const endX = endBoxRect.left - timelineRect.left + endBoxRect.width;
    
    const width = endX - startX;
    
    bar.style.left = startX + 'px';
    bar.style.width = width + 'px';
    
    label.style.left = (startX + width / 2) + 'px';
    
    container.appendChild(bar);
    container.appendChild(label);
    timelineDiv.appendChild(container);
  }, 100);
}

function resetDisplay() {
  monthlyTaxSpan.textContent = '$0';
  sellerCreditSpan.textContent = '$0';
  taxBillPaidSpan.textContent = '$0';
  escrowMonthsSpan.textContent = '0';
  totalEscrowSpan.textContent = '$0';
  firstPaymentSpan.textContent = 'N/A';
  totalClosingTaxSpan.textContent = '$0';
  lenderCalcInfo.innerHTML = '<strong>ðŸ§® How Lenders Calculate:</strong> Enter your closing date and annual property taxes above to see the detailed calculation breakdown.';
  timelineDiv.innerHTML = '';
}

document.getElementById('annualTax').addEventListener('input', calculateAndRender);
document.getElementById('closingDate').addEventListener('change', calculateAndRender);

document.getElementById('closingDate').valueAsDate = new Date();
</script>
</body>
</html>
