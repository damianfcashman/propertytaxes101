<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Help Me Understand My Property Tax Closing Costs</title>
<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body { 
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    min-height: 100vh;
    padding: 20px;
  }

  .container { 
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
    max-width: 1100px;
    margin: auto;
    position: relative;
    overflow: hidden;
  }

  .container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #667eea, #764ba2, #f093fb, #f5576c);
    border-radius: 20px 20px 0 0;
  }

  .title-section { 
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 40px;
    padding-bottom: 20px;
    border-bottom: 2px solid #eee;
  }

  .title-text { 
    font-size: 2.2rem;
    font-weight: 700;
    line-height: 1.2;
    color: #2c3e50;
    background: linear-gradient(135deg, #667eea, #764ba2);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
  }

  .title-section img { 
    width: 120px;
    height: 120px;
    border-radius: 50%;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
    border: 4px solid white;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .title-section img:hover {
    transform: scale(1.05);
  }

  .input-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 25px;
    margin-bottom: 40px;
  }

  .input-group {
    background: white;
    padding: 25px;
    border-radius: 15px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
    border: 2px solid transparent;
    transition: all 0.3s ease;
    position: relative;
  }

  .input-group:hover {
    border-color: #667eea;
    transform: translateY(-2px);
  }

  .input-group::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: linear-gradient(90deg, #667eea, #764ba2);
    border-radius: 15px 15px 0 0;
  }

  label { 
    display: block;
    margin-bottom: 10px;
    font-weight: 600;
    color: #34495e;
    font-size: 14px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  input { 
    width: 100%;
    padding: 15px;
    border: 2px solid #e0e0e0;
    border-radius: 10px;
    font-size: 16px;
    transition: all 0.3s ease;
    background: #fafafa;
    font-family: inherit;
  }

  input:focus {
    outline: none;
    border-color: #667eea;
    background: white;
    box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
  }

  .timeline { 
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin: 40px 0;
    padding: 30px;
    background: linear-gradient(135deg, #f8f9fa, #e9ecef);
    border-radius: 15px;
    box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.05);
  }

  .month-container { 
    display: flex;
    align-items: center;
    margin: 5px 0;
  }

  .arrow { 
    margin: 0 10px;
    font-size: 20px;
    color: #667eea;
    font-weight: bold;
    animation: pulse 2s ease-in-out infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 0.6; }
    50% { opacity: 1; }
  }

  .month-box { 
    border: 2px solid #ddd;
    background: white;
    padding: 15px 10px;
    margin: 5px;
    border-radius: 12px;
    min-width: 85px;
    text-align: center;
    position: relative;
    transition: all 0.3s ease;
    font-weight: 500;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
  }

  .month-box:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .shaded { 
    background: linear-gradient(135deg, #fff7f0, #ffe8d6);
    border-color: #f39c12;
  }

  .closing { 
    font-weight: bold;
    border: 3px solid #667eea;
    background: linear-gradient(135deg, #e6f0ff, #cce0ff);
    box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
    animation: glow 2s ease-in-out infinite alternate;
  }

  @keyframes glow {
    from { box-shadow: 0 0 20px rgba(102, 126, 234, 0.3); }
    to { box-shadow: 0 0 30px rgba(102, 126, 234, 0.5); }
  }

  .month-label { 
    font-size: 10px;
    font-style: italic;
    margin-top: 5px;
    display: block;
    color: #7f8c8d;
    font-weight: normal;
  }

  .first-payment { 
    background: linear-gradient(135deg, #e6ffe6, #ccffcc);
    border-color: #27ae60;
  }

  .tax-due { 
    background: linear-gradient(135deg, #ffe6e6, #ffcccc);
    border-color: #e74c3c;
    font-weight: bold;
  }

  .tooltip { 
    position: absolute;
    bottom: -35px;
    left: 50%;
    transform: translateX(-50%);
    background: #2c3e50;
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 12px;
    display: none;
    white-space: nowrap;
    z-index: 1000;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
  }

  .tooltip::before {
    content: '';
    position: absolute;
    top: -5px;
    left: 50%;
    transform: translateX(-50%);
    border-left: 5px solid transparent;
    border-right: 5px solid transparent;
    border-bottom: 5px solid #2c3e50;
  }

  .month-box:hover .tooltip { 
    display: block;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateX(-50%) translateY(5px); }
    to { opacity: 1; transform: translateX(-50%) translateY(0); }
  }

  .info-box { 
    background: linear-gradient(135deg, #eaf4ff, #d6e9ff);
    border-left: 5px solid #667eea;
    padding: 20px;
    margin: 20px 0;
    border-radius: 10px;
    font-size: 14px;
    text-align: left;
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    transition: all 0.3s ease;
  }

  .info-box:hover {
    transform: translateX(5px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
  }

  .info-box strong {
    color: #2c3e50;
    font-size: 16px;
  }

  .results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 20px;
    margin-top: 30px;
  }

  .result { 
    background: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.1);
    border-left: 4px solid #667eea;
    transition: all 0.3s ease;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .result:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 35px rgba(0, 0, 0, 0.15);
  }

  .result-label {
    font-weight: 600;
    color: #2c3e50;
    font-size: 14px;
  }

  .result-value {
    font-weight: 700;
    font-size: 18px;
    color: #27ae60;
  }

  .result.highlight {
    border-left-color: #f39c12;
    background: linear-gradient(135deg, #fff9e6, #fff3d6);
  }

  .result.highlight .result-value {
    color: #f39c12;
  }

  .summary-box {
    background: linear-gradient(135deg, #2c3e50, #34495e);
    color: white;
    padding: 30px;
    border-radius: 15px;
    margin-top: 30px;
    text-align: center;
    box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
  }

  .summary-box h3 {
    font-size: 1.5rem;
    margin-bottom: 15px;
    color: #ecf0f1;
  }

  .summary-amount {
    font-size: 2.5rem;
    font-weight: 700;
    color: #f1c40f;
    text-shadow: 0 2px 10px rgba(241, 196, 15, 0.3);
  }

  @media (max-width: 768px) {
    .container {
      padding: 20px;
      margin: 10px;
    }
    
    .title-text {
      font-size: 1.8rem;
    }
    
    .title-section {
      flex-direction: column;
      gap: 20px;
      text-align: center;
    }
    
    .input-grid {
      grid-template-columns: 1fr;
    }
    
    .timeline {
      padding: 20px 10px;
    }
    
    .month-box {
      min-width: 70px;
      padding: 12px 8px;
    }
    
    .results-grid {
      grid-template-columns: 1fr;
    }
  }

  .loading {
    opacity: 0.6;
    pointer-events: none;
  }

  .fade-in {
    animation: fadeInUp 0.5s ease-out;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>
</head>
<body>
<div class="container">
  <div class="title-section">
    <div class="title-text">
      Help Me Understand <br />
      My Property Tax Closing Costs
    </div>
    <img src="images/headshot.jpg" alt="Profile Picture" onerror="this.src='https://via.placeholder.com/120x120/667eea/ffffff?text=üë§'" />
  </div>

  <div class="input-grid">
    <div class="input-group">
      <label>üè† Property Address</label>
      <input type="text" id="address" placeholder="123 Main Street, Hartford, CT" />
    </div>
    <div class="input-group">
      <label>üìÖ Closing Date</label>
      <input type="date" id="closingDate" />
    </div>
    <div class="input-group">
      <label>üí∞ Annual Property Taxes ($)</label>
      <input type="number" id="annualTax" placeholder="8500" min="0" step="100" />
    </div>
  </div>

  <div id="timeline" class="timeline"></div>

  <div class="info-box">
    <strong>üè† Property Taxes to the Seller:</strong> When you buy a home, the seller may have already paid property taxes in advance. At closing, you'll reimburse them for your share of the taxes they've already paid for the period you'll own the home.
  </div>
  
  <div class="info-box">
    <strong>üè¶ Property Taxes to the Lender's Escrow Account:</strong> In Connecticut, property taxes are due every 6 months (January 1 and July 1). Your lender collects money in advance and holds it in an escrow account to ensure there are enough funds to pay the next tax bill when it comes due.
  </div>
  
  <div class="info-box" id="lenderCalcInfo">
    <strong>üßÆ How Lenders Calculate:</strong> Enter your closing date and annual tax amount above to see the detailed calculation.
  </div>

  <div class="results-grid" id="resultsGrid">
    <div class="result">
      <div class="result-label">Monthly Tax Amount</div>
      <div class="result-value" id="monthlyTax">$0</div>
    </div>
    
    <div class="result highlight">
      <div class="result-label">Property Tax You Owe to Seller</div>
      <div class="result-value" id="sellerCredit">$0</div>
    </div>
    
    <div class="result">
      <div class="result-label">Tax Bill Paid at Closing</div>
      <div class="result-value" id="taxBillPaid">$0</div>
    </div>
    
    <div class="result">
      <div class="result-label">Months Collected in Escrow</div>
      <div class="result-value" id="escrowMonths">0</div>
    </div>
    
    <div class="result highlight">
      <div class="result-label">Total Escrow Collected</div>
      <div class="result-value" id="totalEscrow">$0</div>
    </div>
    
    <div class="result">
      <div class="result-label">First Mortgage Payment</div>
      <div class="result-value" id="firstPayment">N/A</div>
    </div>
  </div>

  <div class="summary-box">
    <h3>Total Property Tax Costs at Closing</h3>
    <div class="summary-amount" id="totalClosingTax">$0</div>
  </div>
</div>

<script>
const monthlyTaxSpan = document.getElementById('monthlyTax');
const sellerCreditSpan = document.getElementById('sellerCredit');
const taxBillPaidSpan = document.getElementById('taxBillPaid');
const escrowMonthsSpan = document.getElementById('escrowMonths');
const totalEscrowSpan = document.getElementById('totalEscrow');
const firstPaymentSpan = document.getElementById('firstPayment');
const totalClosingTaxSpan = document.getElementById('totalClosingTax');
const lenderCalcInfo = document.getElementById('lenderCalcInfo');
const timelineDiv = document.getElementById('timeline');
const resultsGrid = document.getElementById('resultsGrid');
const allMonths = ["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];

function formatCurrency(amount) {
  return new Intl.NumberFormat('en-US', {
    style: 'currency',
    currency: 'USD',
    minimumFractionDigits: 0,
    maximumFractionDigits: 0
  }).format(amount);
}

function calculateAndRender() {
  const annualTax = parseFloat(document.getElementById('annualTax').value) || 0;
  const closingDateInput = document.getElementById('closingDate').value;
  
  if (!annualTax || !closingDateInput) {
    // Clear results if inputs are empty
    monthlyTaxSpan.textContent = '$0';
    sellerCreditSpan.textContent = '$0';
    taxBillPaidSpan.textContent = '$0';
    escrowMonthsSpan.textContent = '0';
    totalEscrowSpan.textContent = '$0';
    firstPaymentSpan.textContent = 'N/A';
    totalClosingTaxSpan.textContent = '$0';
    timelineDiv.innerHTML = '<div style="text-align: center; color: #7f8c8d; font-style: italic;">Enter your closing date and annual tax amount to view timeline</div>';
    return;
  }

  const monthlyTax = annualTax / 12;
  monthlyTaxSpan.textContent = formatCurrency(monthlyTax);

  const closingDate = new Date(closingDateInput);
  const closingMonth = closingDate.getMonth();
  const closingYear = closingDate.getFullYear();
  const halfYearTax = annualTax / 2;

  const currentPeriodStart = (closingMonth >= 6) ? new Date(closingYear, 6, 1) : new Date(closingYear, 0, 1);
  const currentPeriodEnd = (closingMonth >= 6) ? new Date(closingYear + 1, 0, 1) : new Date(closingYear, 6, 1);

  const msPerDay = 1000 * 60 * 60 * 24;
  const totalDays = Math.ceil((currentPeriodEnd - currentPeriodStart) / msPerDay);
  const daysRemaining = Math.ceil((currentPeriodEnd - closingDate) / msPerDay);
  const sellerCredit = (halfYearTax / totalDays) * daysRemaining;
  sellerCreditSpan.textContent = formatCurrency(sellerCredit);

  const nextBillDate = (closingMonth >= 6) ? new Date(closingYear + 1, 0, 1) : new Date(closingYear, 6, 1);
  const daysToNextBill = Math.ceil((nextBillDate - closingDate) / msPerDay);

  // Calculate escrow months with 1-month buffer
  let taxBillPaid = 0;
  let escrowMonths = 0;

  if (daysToNextBill <= 60) {
    taxBillPaid = halfYearTax;
    escrowMonths = 1 + 1; // shortfall 1 + buffer 1 = 2
  } else {
    // Short months until next bill
    const monthsShort = (closingMonth >= 6)
      ? (12 - (closingMonth + 1)) // to Dec
      : (6 - (closingMonth + 1)); // to Jun
    escrowMonths = monthsShort + 1; // add 1 buffer
  }

  taxBillPaidSpan.textContent = formatCurrency(taxBillPaid);
  escrowMonthsSpan.textContent = escrowMonths;
  const totalEscrowAmount = monthlyTax * escrowMonths;
  totalEscrowSpan.textContent = formatCurrency(totalEscrowAmount);

  // Calculate total closing tax costs
  const totalClosingCosts = sellerCredit + taxBillPaid + totalEscrowAmount;
  totalClosingTaxSpan.textContent = formatCurrency(totalClosingCosts);

  // Correct first mortgage payment
  let firstPaymentMonth = (closingMonth + 2) % 12;
  let firstPaymentYear = closingYear + Math.floor((closingMonth + 2) / 12);
  let firstPaymentDate = new Date(firstPaymentYear, firstPaymentMonth, 1);
  firstPaymentSpan.textContent = `${allMonths[firstPaymentDate.getMonth()]} ${firstPaymentDate.getFullYear()}`;

  lenderCalcInfo.innerHTML =
    `<strong>üßÆ How Lenders Calculate:</strong> At closing, you reimburse the seller ${formatCurrency(sellerCredit)} for taxes they prepaid. ` +
    `${taxBillPaid > 0 ? `The settlement agent also collects ${formatCurrency(taxBillPaid)} to pay the upcoming tax bill. ` : ''}` +
    `Additionally, the lender collects ${escrowMonths} months of taxes (${formatCurrency(totalEscrowAmount)}) including a 1-month buffer ` +
    `to ensure funds are ready for future tax payments.`;

  renderTimeline(closingDate, firstPaymentDate, nextBillDate, taxBillPaid, closingMonth, nextBillDate.getMonth());
  
  // Add animation to results
  resultsGrid.classList.add('fade-in');
  setTimeout(() => resultsGrid.classList.remove('fade-in'), 500);
}

function renderTimeline(closingDate, firstPaymentDate, nextBillDate, taxBillPaid, closingMonth, nextBillMonth) {
  timelineDiv.innerHTML = '';

  let monthsToShow = [];
  
  // Start from beginning of current tax period for better context
  let currentTaxPeriodStart = (closingMonth >= 6) ? 6 : 0; // July or January
  let current = currentTaxPeriodStart;
  
  // Show current tax period months from the beginning
  while (true) {
    monthsToShow.push(current);
    if (current === nextBillMonth) break;
    current = (current + 1) % 12;
  }
  
  // Show next 6 months after tax bill
  for (let i = 1; i <= 6; i++) {
    monthsToShow.push((nextBillMonth + i) % 12);
  }

  monthsToShow.forEach((monthIdx, index) => {
    const container = document.createElement("div");
    container.classList.add("month-container");

    const monthBox = document.createElement("div");
    monthBox.classList.add("month-box");

    // July-Dec months get shaded (second half of year)
    if (monthIdx >= 6) monthBox.classList.add("shaded");

    let label = '';
    let tooltip = '';
    
    // Closing month
    if (monthIdx === closingMonth) {
      monthBox.classList.add("closing");
      label = "üè†<br><span class='month-label'>Closing Month</span>";
      tooltip = "Your closing happens this month";
    }
    // Current tax period months (before closing)
    else if (index < monthsToShow.indexOf(closingMonth)) {
      label = "üí∞";
      tooltip = "Taxes already paid by seller for this month";
    }
    // Current tax period months (after closing, before next bill)
    else if (index > monthsToShow.indexOf(closingMonth) && index < monthsToShow.indexOf(nextBillMonth)) {
      label = "üí∞";
      tooltip = "You owe seller for taxes they prepaid for this month";
    }
    // Tax due months (Jan and Jul)
    else if (monthIdx === 0 || monthIdx === 6) {
      monthBox.classList.add("tax-due");
      if (index === monthsToShow.indexOf(nextBillMonth)) {
        label = "üßæ<br><span class='month-label'>Next Tax Due</span>";
        tooltip = "Next property tax bill is due this month";
      } else {
        label = "üßæ<br><span class='month-label'>Tax Due</span>";
        tooltip = "Property tax bill due this month";
      }
    }

    // First payment highlight
    if (monthIdx === firstPaymentDate.getMonth()) {
      monthBox.classList.add("first-payment");
      if (!label.includes('üè†') && !label.includes('üßæ')) {
        label = "üí≥<br><span class='month-label'>First Payment</span>";
        tooltip = "Your first mortgage payment is due this month";
      }
    }

    if (!label) {
      label = "üìÖ";
      tooltip = "Regular month in tax cycle";
    }

    monthBox.innerHTML = `${allMonths[monthIdx]}<br>${label}${tooltip ? `<div class='tooltip'>${tooltip}</div>` : ''}`;
    container.appendChild(monthBox);

    if (index < monthsToShow.length - 1) {
      const arrow = document.createElement("div");
      arrow.classList.add("arrow");
      arrow.textContent = "‚Üí";
      container.appendChild(arrow);
    }
    
    timelineDiv.appendChild(container);
  });
}

// Set default date to today
document.getElementById('closingDate').value = new Date().toISOString().split('T')[0];

// Event listeners with debouncing for better performance
let timeoutId;
function debouncedCalculate() {
  clearTimeout(timeoutId);
  timeoutId = setTimeout(calculateAndRender, 300);
}

document.getElementById('annualTax').addEventListener('input', debouncedCalculate);
document.getElementById('closingDate').addEventListener('change', calculateAndRender);
document.getElementById('address').addEventListener('input', () => {
  // You could add address validation or geocoding here
});

// Initial calculation
calculateAndRender();
</script>
</body>
</html>
